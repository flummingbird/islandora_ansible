---

#- name: Check if Solr sources have been downloaded already
#  stat: path="{{work_dir}}/solr-{{solr_version}}"
#  register: solr


- name: Get Solr
#  copy: dest=/usr/local/ src="/opt/solr-{{solr_version}}/example/solr/" owner=tomcat7 group=tomcat7 remote_src=yes
  command: 'cp -r /opt/solr-{{solr_version}}/example/solr /usr/local/'

- name: give ownership to tomcat7
  file:
    path: /usr/local/solr
    state: directory
    owner: tomcat7
    group: tomcat7

- name: copy solr.war into tomcat
  copy: dest="/var/lib/tomcat7/webapps/solr.war" src="/opt/solr-{{solr_version}}/dist/solr-{{solr_version}}.war" owner=tomcat7 group=tomcat7 remote_src=yes

- name: link solr to tomcat
  file: 
    src: "{{solr_home}}" 
    dest: /var/lib/tomcat7/solr
    state: link
    owner: tomcat7
    group: tomcat7

- name: Restart tomcat
  service: name=tomcat7 state=restarted
